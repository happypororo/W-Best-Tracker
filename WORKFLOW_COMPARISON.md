# 워크플로우 비교: 이전 vs 개선

## 🔄 변경 전 (문제 있음)

```
┌─────────────────────────────────────────┐
│  GitHub Actions (매시간 :20)             │
│  - Python 설치                          │
│  - Playwright 설치                      │
│  - Chromium 설치 (느림!)                │
│  - auto_crawl.py 실행                   │
│  - DB 파일 생성                         │
└────────────┬────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────┐
│  Git에 DB 파일 커밋 & Push               │
│  - wconcept_tracking.db (23MB)          │
│  - 매시간 커밋 생성                      │
│  - Git history 무거워짐                 │
└────────────┬────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────┐
│  fly-deploy.yml 자동 트리거 ⚠️           │
│  - GitHub Actions Queue 대기            │
│  - 다른 workflow와 충돌 가능            │
└────────────┬────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────┐
│  Fly.io 재배포 (느림!)                   │
│  - Docker 이미지 빌드                   │
│  - 배포 프로세스 (2-3분)                │
│  - Health check 대기                    │
└────────────┬────────────────────────────┘
             │
             ▼
        ✅ 완료 (총 5-6분)
```

### ⚠️ 문제점:
1. **Queue 이슈**: fly-deploy.yml이 대기할 수 있음
2. **느림**: 크롤링 + 재배포 = 5-6분
3. **Git 무거워짐**: DB 파일이 매시간 커밋됨
4. **충돌 가능**: 수동 크롤링과 자동 크롤링 DB 충돌

---

## ✅ 변경 후 (개선됨)

```
┌─────────────────────────────────────────┐
│  GitHub Actions (매시간 :20)             │
│  - 단순 HTTP 요청만! (curl)             │
│  - POST /api/crawl/trigger             │
│  - 초경량 (설치 없음)                   │
└────────────┬────────────────────────────┘
             │ (HTTP 요청)
             ▼
┌─────────────────────────────────────────┐
│  Fly.io API 서버                        │
│  - /api/crawl/trigger 엔드포인트        │
│  - 백그라운드로 크롤링 시작             │
└────────────┬────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────┐
│  Fly.io에서 직접 크롤링 실행             │
│  - auto_crawl.py 실행                   │
│  - Playwright 이미 설치됨               │
│  - Volume DB 직접 업데이트              │
│  - /data/wconcept_tracking.db           │
└────────────┬────────────────────────────┘
             │
             ▼
        ✅ 완료 (총 2-3분)
        
❌ Git push 없음
❌ 재배포 없음
❌ Queue 없음
```

### ✅ 장점:
1. **빠름**: 크롤링만 = 2-3분 (50% 시간 절약!)
2. **Queue 없음**: 재배포 안 하므로 대기 없음
3. **Git 깨끗함**: DB 파일 커밋 안 함
4. **충돌 없음**: 자동/수동 모두 같은 DB 사용

---

## 📊 비교표

| 항목 | 이전 방식 | 개선된 방식 |
|------|----------|-----------|
| **실행 위치** | GitHub Actions 서버 | Fly.io 서버 |
| **설치 필요** | Python, Playwright, Chromium | 없음 (이미 설치됨) |
| **크롤링 시간** | 2-3분 | 2-3분 |
| **Git Push** | ✅ 있음 (문제!) | ❌ 없음 |
| **재배포** | ✅ 있음 (느림!) | ❌ 없음 |
| **총 시간** | 5-6분 | 2-3분 |
| **Queue 이슈** | ⚠️ 가능 | ✅ 없음 |
| **DB 충돌** | ⚠️ 가능 | ✅ 없음 |
| **Git History** | 🔴 무거워짐 | ✅ 깨끗함 |

---

## 🔍 흐름도 비교

### 이전 방식 (복잡함)
```
GitHub Actions → 크롤링 → Git Push → Trigger Deploy → Fly.io 재배포 → 완료
     (느림)        (2분)    (30초)      (Queue!)        (2-3분)
```

### 개선된 방식 (심플함)
```
GitHub Actions → API 호출 → Fly.io 크롤링 → 완료
     (1초)         (1초)        (2-3분)
```

---

## 🎯 핵심 차이점

### ❌ 이전: "GitHub에서 크롤링 → DB를 Git에 Push → Fly.io가 받아서 재배포"
- GitHub → GitHub (Git Push)
- GitHub → Fly.io (재배포 트리거)
- **문제**: 두 번의 GitHub Actions 실행 (Queue!)

### ✅ 개선: "GitHub에서 API 호출 → Fly.io가 직접 크롤링"
- GitHub → Fly.io (단순 HTTP 요청)
- **장점**: GitHub Actions는 1초 만에 끝남, Queue 없음!

---

## 🚀 수동 크롤링은?

### Dashboard 버튼 클릭 시
```
Dashboard → POST /api/crawl/trigger → Fly.io 크롤링 → 완료
```

**동일한 경로!**
- 자동이든 수동이든 같은 API 호출
- 같은 DB 사용 (/data/wconcept_tracking.db)
- 충돌 없음!

---

## ✅ 결론

**개선된 방식이 훨씬 좋습니다!**

1. ⚡ **2배 빠름** (5-6분 → 2-3분)
2. 🎯 **Queue 이슈 없음**
3. 🧹 **Git repository 깨끗함**
4. 🔒 **DB 충돌 없음**
5. 🎉 **간단함!**

**추천**: 즉시 개선된 방식으로 변경!
