name: Remove Fly.io Volume

on:
  workflow_dispatch:

jobs:
  remove-volume:
    runs-on: ubuntu-latest
    
    steps:
      - name: 🚀 Setup Fly.io CLI
        uses: superfly/flyctl-actions/setup-flyctl@master
      
      - name: 📋 List machines (before)
        run: flyctl machine list -a w-best-tracker
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: 🗑️ Destroy machine with volume
        run: flyctl machine destroy 7817642f9552d8 -a w-best-tracker --force
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: 📋 List machines (after)
        run: flyctl machine list -a w-best-tracker
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: ✅ Done
        run: |
          echo "=========================================="
          echo "✅ 머신이 제거되었습니다!"
          echo "이제 fly.toml을 수정한 후 다시 배포하세요."
          echo "=========================================="
