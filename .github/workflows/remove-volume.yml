name: Remove Fly.io Volume

on:
  workflow_dispatch:

jobs:
  remove-volume:
    runs-on: ubuntu-latest
    
    steps:
      - name: 🚀 Setup Fly.io CLI
        uses: superfly/flyctl-actions/setup-flyctl@master
      
      - name: 📋 List volumes (before)
        run: flyctl volumes list -a w-best-tracker || true
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: 🗑️ Destroy machine with volume
        run: flyctl machine destroy 7817642f9552d8 -a w-best-tracker --force
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: 📋 List volumes (after)
        run: flyctl volumes list -a w-best-tracker || true
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: ✅ Done
        run: |
          echo "=========================================="
          echo "✅ 머신이 제거되었습니다!"
          echo "이제 다음 배포 시 새 머신이 볼륨 없이 생성됩니다."
          echo "=========================================="
